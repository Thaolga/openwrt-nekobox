<%#
    Spectra is a clean HTML5 theme for LuCI. It is based on luci-theme-material Argon Template
    luci-theme-spectra
    Copyright 2020 Jerrykuku <jerrykuku@qq.com>
    Have a bug? Please create an issue here on GitHub!
    https://github.com/jerrykuku/luci-theme-spectra/issues
    luci-theme-material:
    Copyright 2015 Lutty Yang <lutty@wcan.in>
    Agron Theme
    https://demos.creative-tim.com/spectra-dashboard/index.html
    Licensed to the public under the Apache License 2.0
-%>

<%
local api = require "luci.passwall.api"
-%>

<% local ver = require("luci.version") %>
</div>
<footer class="mobile-hide" style="display: none;">
    <a href="https://github.com/openwrt/luci" class="powered-by" target="_blank" rel="noopener noreferrer">Powered by <%= ver.luciname %> (<%= ver.luciversion %>)</a> / <a href="https://github.com/openwrt/openwrt" target="_blank" class="version" rel="noopener noreferrer"><%= ver.distversion %></a>
    <ul class="breadcrumb pull-right" id="modemenu" style="display:none"></ul>
</footer>
</div>
</div>
<div id="tempcpu"></div>
<div id="cpuusage"></div>
<script>
    var luciLocation = <%= luci.http.write_json(luci.dispatcher.context.path) %>;
    var winHeight = $(window).height();
    $(window).resize(function () {
        var winWidth = $(window).width();
        if (winWidth < 600) {
            var newHeight = $(this).height();
            var keyboradHeight = newHeight - winHeight;
            $(".ftc").css("bottom", keyboradHeight + 30);
        }
    });
</script>
<script type="text/javascript">L.require('menu-spectra')</script>
<script>
    window.addEventListener('load', function() {
        setTimeout(function() {
            const footer = document.querySelector('footer.mobile-hide');
            if (footer) {
                footer.style.display = 'block';
            }
        }, 800);
    });
</script>

<script>
const countryMap = {
    'é˜¿å¯Œæ±—': 'ðŸ‡¦ðŸ‡«', 'é˜¿å°”å·´å°¼äºš': 'ðŸ‡¦ðŸ‡±', 'é˜¿å°”åŠåˆ©äºš': 'ðŸ‡©ðŸ‡¿', 'é˜¿æ ¹å»·': 'ðŸ‡¦ðŸ‡·', 'é˜¿æ›¼': 'ðŸ‡´ðŸ‡²',
    'é˜¿å¡žæ‹œç–†': 'ðŸ‡¦ðŸ‡¿', 'çˆ±å°”å…°': 'ðŸ‡®ðŸ‡ª', 'åŸƒåŠ': 'ðŸ‡ªðŸ‡¬', 'åŸƒå¡žä¿„æ¯”äºš': 'ðŸ‡ªðŸ‡¹', 'æ¾³å¤§åˆ©äºš': 'ðŸ‡¦ðŸ‡º',
    'å¥¥åœ°åˆ©': 'ðŸ‡¦ðŸ‡¹', 'å·´å·´å¤šæ–¯': 'ðŸ‡§ðŸ‡§', 'å·´å“ˆé©¬': 'ðŸ‡§ðŸ‡¸', 'å·´åŸºæ–¯å¦': 'ðŸ‡µðŸ‡°', 'å·´æ‹¿é©¬': 'ðŸ‡µðŸ‡¦',
    'å·´å¸ƒäºšæ–°å‡ å†…äºš': 'ðŸ‡µðŸ‡¬', 'å·´æ‹‰åœ­': 'ðŸ‡µðŸ‡¾', 'å·´æž—': 'ðŸ‡§ðŸ‡­', 'å·´è¥¿': 'ðŸ‡§ðŸ‡·', 'ç™½ä¿„ç½—æ–¯': 'ðŸ‡§ðŸ‡¾',
    'ä¿åŠ åˆ©äºš': 'ðŸ‡§ðŸ‡¬', 'åŒ—é©¬é‡Œäºšçº³ç¾¤å²›': 'ðŸ‡²ðŸ‡µ', 'æ¯”åˆ©æ—¶': 'ðŸ‡§ðŸ‡ª', 'å†°å²›': 'ðŸ‡®ðŸ‡¸', 'æ³¢å…°': 'ðŸ‡µðŸ‡±',
    'æ³¢å¤šé»Žå„': 'ðŸ‡µðŸ‡·', 'çŽ»åˆ©ç»´äºš': 'ðŸ‡§ðŸ‡´', 'åšèŒ¨ç“¦çº³': 'ðŸ‡§ðŸ‡¼', 'ä¸¹éº¦': 'ðŸ‡©ðŸ‡°', 'å¾·å›½': 'ðŸ‡©ðŸ‡ª',
    'ä¸œå¸æ±¶': 'ðŸ‡¹ðŸ‡±', 'å¤šå“¥': 'ðŸ‡¹ðŸ‡¬', 'å¤šç±³å°¼åŠ ': 'ðŸ‡©ðŸ‡´', 'åŽ„ç“œå¤šå°”': 'ðŸ‡ªðŸ‡¨', 'åŽ„ç«‹ç‰¹é‡Œäºš': 'ðŸ‡ªðŸ‡·',
    'æ³•å›½': 'ðŸ‡«ðŸ‡·', 'æ³•ç½—ç¾¤å²›': 'ðŸ‡«ðŸ‡´', 'æ³•å±žåœ­äºšé‚£': 'ðŸ‡¬ðŸ‡«', 'èŠ¬å…°': 'ðŸ‡«ðŸ‡®', 'è²å¾‹å®¾': 'ðŸ‡µðŸ‡­',
    'ç¦å…‹å…°ç¾¤å²›': 'ðŸ‡«ðŸ‡°', 'å†ˆæ¯”äºš': 'ðŸ‡¬ðŸ‡²', 'åˆšæžœï¼ˆå¸ƒï¼‰': 'ðŸ‡¨ðŸ‡¬', 'åˆšæžœï¼ˆé‡‘ï¼‰': 'ðŸ‡¨ðŸ‡©', 'å“¥ä¼¦æ¯”äºš': 'ðŸ‡¨ðŸ‡´',
    'å“¥æ–¯è¾¾é»ŽåŠ ': 'ðŸ‡¨ðŸ‡·', 'æ ¼é²å‰äºš': 'ðŸ‡¬ðŸ‡ª', 'æ ¼æž—çº³è¾¾': 'ðŸ‡¬ðŸ‡©', 'å…³å²›': 'ðŸ‡¬ðŸ‡º', 'ç“œå¾·ç½—æ™®': 'ðŸ‡¬ðŸ‡µ',
    'å“ˆè¨å…‹æ–¯å¦': 'ðŸ‡°ðŸ‡¿', 'æµ·åœ°': 'ðŸ‡­ðŸ‡¹', 'éŸ©å›½': 'ðŸ‡°ðŸ‡·', 'è·å…°': 'ðŸ‡³ðŸ‡±', 'è·å…°åŠ å‹’æ¯”': 'ðŸ‡§ðŸ‡¶',
    'é»‘å±±': 'ðŸ‡²ðŸ‡ª', 'æ´ªéƒ½æ‹‰æ–¯': 'ðŸ‡­ðŸ‡³', 'åŸºé‡Œå·´æ–¯': 'ðŸ‡°ðŸ‡®', 'å‰å¸ƒæ': 'ðŸ‡©ðŸ‡¯', 'å‡ å†…äºš': 'ðŸ‡¬ðŸ‡³',
    'å‡ å†…äºšæ¯”ç»': 'ðŸ‡¬ðŸ‡¼', 'åŠ æ‹¿å¤§': 'ðŸ‡¨ðŸ‡¦', 'åŠ è“¬': 'ðŸ‡¬ðŸ‡¦', 'æŸ¬åŸ”å¯¨': 'ðŸ‡°ðŸ‡­', 'æ·å…‹': 'ðŸ‡¨ðŸ‡¿',
    'æ´¥å·´å¸ƒéŸ¦': 'ðŸ‡¿ðŸ‡¼', 'å¡å¡”å°”': 'ðŸ‡¶ðŸ‡¦', 'å–€éº¦éš†': 'ðŸ‡¨ðŸ‡²', 'ç§‘æ‘©ç½—': 'ðŸ‡°ðŸ‡²', 'ç§‘ç´¢æ²ƒ': 'ðŸ‡½ðŸ‡°',
    'ç§‘å¨ç‰¹': 'ðŸ‡°ðŸ‡¼', 'è‚¯å°¼äºš': 'ðŸ‡°ðŸ‡ª', 'æ‹‰è„±ç»´äºš': 'ðŸ‡±ðŸ‡»', 'èŽ±ç´¢æ‰˜': 'ðŸ‡±ðŸ‡¸', 'é»Žå·´å«©': 'ðŸ‡±ðŸ‡§',
    'åˆ©æ¯”é‡Œäºš': 'ðŸ‡±ðŸ‡·', 'åˆ©æ¯”äºš': 'ðŸ‡±ðŸ‡¾', 'åˆ—æ”¯æ•¦å£«ç™»': 'ðŸ‡±ðŸ‡®', 'ç«‹é™¶å®›': 'ðŸ‡±ðŸ‡¹', 'å¢æ£®å ¡': 'ðŸ‡±ðŸ‡º',
    'æ¯›é‡Œå¡”å°¼äºš': 'ðŸ‡²ðŸ‡·', 'é©¬è¾¾åŠ æ–¯åŠ ': 'ðŸ‡²ðŸ‡¬', 'é©¬æ‹‰ç»´': 'ðŸ‡²ðŸ‡¼', 'é©¬æ¥è¥¿äºš': 'ðŸ‡²ðŸ‡¾', 'é©¬å°”ä»£å¤«': 'ðŸ‡²ðŸ‡»',
    'é©¬é‡Œ': 'ðŸ‡²ðŸ‡±', 'é©¬è€³ä»–': 'ðŸ‡²ðŸ‡¹', 'é©¬ç»å°”ç¾¤å²›': 'ðŸ‡²ðŸ‡­', 'é©¬æå°¼å…‹': 'ðŸ‡²ðŸ‡¶', 'æ¯›é‡Œæ±‚æ–¯': 'ðŸ‡²ðŸ‡º',
    'è’™å¤': 'ðŸ‡²ðŸ‡³', 'ç¾Žå›½': 'ðŸ‡ºðŸ‡¸', 'ç¾Žå±žç»´å°”äº¬ç¾¤å²›': 'ðŸ‡»ðŸ‡®', 'å¯†å…‹ç½—å°¼è¥¿äºš': 'ðŸ‡«ðŸ‡²', 'ç¼…ç”¸': 'ðŸ‡²ðŸ‡²',
    'å—éž': 'ðŸ‡¿ðŸ‡¦', 'å—è‹ä¸¹': 'ðŸ‡¸ðŸ‡¸', 'å°¼æ³Šå°”': 'ðŸ‡³ðŸ‡µ', 'å°¼æ—¥å°”': 'ðŸ‡³ðŸ‡ª', 'å°¼æ—¥åˆ©äºš': 'ðŸ‡³ðŸ‡¬',
    'æŒªå¨': 'ðŸ‡³ðŸ‡´', 'è¯ºç¦å…‹å²›': 'ðŸ‡³ðŸ‡«', 'å¸•åŠ³': 'ðŸ‡µðŸ‡¼', 'è‘¡è„ç‰™': 'ðŸ‡µðŸ‡¹', 'æ—¥æœ¬': 'ðŸ‡¯ðŸ‡µ',
    'ç‘žå…¸': 'ðŸ‡¸ðŸ‡ª', 'ç‘žå£«': 'ðŸ‡¨ðŸ‡­', 'è¨å°”ç“¦å¤š': 'ðŸ‡¸ðŸ‡»', 'å¡žå°”ç»´äºš': 'ðŸ‡·ðŸ‡¸', 'å¡žæ‹‰åˆ©æ˜‚': 'ðŸ‡¸ðŸ‡±',
    'å¡žèˆŒå°”': 'ðŸ‡¸ðŸ‡¨', 'æ²™ç‰¹é˜¿æ‹‰ä¼¯': 'ðŸ‡¸ðŸ‡¦', 'åœ£åŸºèŒ¨å’Œå°¼ç»´æ–¯': 'ðŸ‡°ðŸ‡³', 'åœ£å¢è¥¿äºš': 'ðŸ‡±ðŸ‡¨', 'åœ£é©¬åŠ›è¯º': 'ðŸ‡¸ðŸ‡²',
    'åœ£å¤šç¾Žå’Œæ™®æž—è¥¿æ¯”': 'ðŸ‡¸ðŸ‡¹', 'åœ£æ–‡æ£®ç‰¹å’Œæ ¼æž—çº³ä¸æ–¯': 'ðŸ‡»ðŸ‡¨', 'æ–¯é‡Œå…°å¡': 'ðŸ‡±ðŸ‡°', 'æ–¯æ´›ä¼å…‹': 'ðŸ‡¸ðŸ‡°',
    'æ–¯æ´›æ–‡å°¼äºš': 'ðŸ‡¸ðŸ‡®', 'æ–¯å¨å£«å…°': 'ðŸ‡¸ðŸ‡¿', 'æ‰€ç½—é—¨ç¾¤å²›': 'ðŸ‡¸ðŸ‡§', 'è‹ä¸¹': 'ðŸ‡¸ðŸ‡©', 'è‹é‡Œå—': 'ðŸ‡¸ðŸ‡·',
    'å°æ¹¾': 'ðŸ‡¹ðŸ‡¼', 'å¦æ¡‘å°¼äºš': 'ðŸ‡¹ðŸ‡¿', 'æ³°å›½': 'ðŸ‡¹ðŸ‡­', 'æ±¤åŠ ': 'ðŸ‡¹ðŸ‡´', 'åœŸè€³å…¶': 'ðŸ‡¹ðŸ‡·',
    'åœŸåº“æ›¼æ–¯å¦': 'ðŸ‡¹ðŸ‡²', 'çªå°¼æ–¯': 'ðŸ‡¹ðŸ‡³', 'å›¾ç“¦å¢': 'ðŸ‡¹ðŸ‡»', 'ç“¦åŠªé˜¿å›¾': 'ðŸ‡»ðŸ‡º', 'å±åœ°é©¬æ‹‰': 'ðŸ‡¬ðŸ‡¹',
    'ä¹Œå¹²è¾¾': 'ðŸ‡ºðŸ‡¬', 'ä¹Œå…‹å…°': 'ðŸ‡ºðŸ‡¦', 'ä¹Œæ‹‰åœ­': 'ðŸ‡ºðŸ‡¾', 'ä¹Œå…¹åˆ«å…‹æ–¯å¦': 'ðŸ‡ºðŸ‡¿', 'è¥¿ç­ç‰™': 'ðŸ‡ªðŸ‡¸',
    'å¸Œè…Š': 'ðŸ‡¬ðŸ‡·', 'æ–°åŠ å¡': 'ðŸ‡¸ðŸ‡¬', 'æ–°å–€é‡Œå¤šå°¼äºš': 'ðŸ‡³ðŸ‡¨', 'æ–°è¥¿å…°': 'ðŸ‡³ðŸ‡¿', 'åŒˆç‰™åˆ©': 'ðŸ‡­ðŸ‡º',
    'å™åˆ©äºš': 'ðŸ‡¸ðŸ‡¾', 'ç‰™ä¹°åŠ ': 'ðŸ‡¯ðŸ‡²', 'ä¼Šæœ—': 'ðŸ‡®ðŸ‡·', 'ä¼Šæ‹‰å…‹': 'ðŸ‡®ðŸ‡¶', 'æ„å¤§åˆ©': 'ðŸ‡®ðŸ‡¹',
    'ä»¥è‰²åˆ—': 'ðŸ‡®ðŸ‡±', 'å°åº¦': 'ðŸ‡®ðŸ‡³', 'å°åº¦å°¼è¥¿äºš': 'ðŸ‡®ðŸ‡©', 'è‹±å›½': 'ðŸ‡¬ðŸ‡§', 'çº¦æ—¦': 'ðŸ‡¯ðŸ‡´',
    'æ³½è¥¿': 'ðŸ‡¯ðŸ‡ª', 'èµžæ¯”äºš': 'ðŸ‡¿ðŸ‡²', 'ä¹å¾—': 'ðŸ‡¹ðŸ‡©', 'æ™ºåˆ©': 'ðŸ‡¨ðŸ‡±', 'ä¸­éžå…±å’Œå›½': 'ðŸ‡¨ðŸ‡«',
    'ä¸­å›½': 'ðŸ‡¨ðŸ‡³', 'ç›´å¸ƒç½—é™€': 'ðŸ‡¬ðŸ‡®', 'å°æ¹¾': 'ðŸ‡¹ðŸ‡¼', 'æœ±è¯º': 'ðŸ‡¯ðŸ‡ª', 'é¦™æ¸¯': 'ðŸ‡­ðŸ‡°', 'æ¾³é—¨': 'ðŸ‡²ðŸ‡´',
    'å®‰é“å°”': 'ðŸ‡¦ðŸ‡©', 'å®‰å“¥æ‹‰': 'ðŸ‡¦ðŸ‡´', 'å®‰æç“œå’Œå·´å¸ƒè¾¾': 'ðŸ‡¦ðŸ‡¬', 'äºšç¾Žå°¼äºš': 'ðŸ‡¦ðŸ‡²', 'å­ŸåŠ æ‹‰å›½': 'ðŸ‡§ðŸ‡©',
    'ä¼¯åˆ©å…¹': 'ðŸ‡§ðŸ‡¿', 'è´å®': 'ðŸ‡§ðŸ‡¯', 'ä¸ä¸¹': 'ðŸ‡§ðŸ‡¹', 'æ³¢æ–¯å°¼äºšå’Œé»‘å¡žå“¥ç»´é‚£': 'ðŸ‡§ðŸ‡¦', 'æ–‡èŽ±': 'ðŸ‡§ðŸ‡³',
    'å¸ƒåŸºçº³æ³•ç´¢': 'ðŸ‡§ðŸ‡«', 'å¸ƒéš†è¿ª': 'ðŸ‡§ðŸ‡®', 'ä½›å¾—è§’': 'ðŸ‡¨ðŸ‡»', 'å“¥æ–¯è¾¾é»ŽåŠ ': 'ðŸ‡¨ðŸ‡·', 'ç§‘ç‰¹è¿ªç“¦': 'ðŸ‡¨ðŸ‡®',
    'å…‹ç½—åœ°äºš': 'ðŸ‡­ðŸ‡·', 'å¤å·´': 'ðŸ‡¨ðŸ‡º', 'å¡žæµ¦è·¯æ–¯': 'ðŸ‡¨ðŸ‡¾', 'å¤šç±³å°¼å…‹': 'ðŸ‡©ðŸ‡²', 'å¤šæ˜Žå°¼åŠ å…±å’Œå›½': 'ðŸ‡©ðŸ‡´',
    'è¨å°”ç“¦å¤š': 'ðŸ‡¸ðŸ‡»', 'èµ¤é“å‡ å†…äºš': 'ðŸ‡¬ðŸ‡¶', 'åŽ„ç«‹ç‰¹é‡Œäºš': 'ðŸ‡ªðŸ‡·', 'çˆ±æ²™å°¼äºš': 'ðŸ‡ªðŸ‡ª', 'æ–æµŽ': 'ðŸ‡«ðŸ‡¯',
    'åŠ çº³': 'ðŸ‡¬ðŸ‡­', 'æ ¼æž—çº³è¾¾': 'ðŸ‡¬ðŸ‡©', 'åœ­äºšé‚£': 'ðŸ‡¬ðŸ‡¾', 'æ´ªéƒ½æ‹‰æ–¯': 'ðŸ‡­ðŸ‡³', 'å†°å²›': 'ðŸ‡®ðŸ‡¸',
    'çº¦æ—¦': 'ðŸ‡¯ðŸ‡´', 'è‚¯å°¼äºš': 'ðŸ‡°ðŸ‡ª', 'åŸºé‡Œå·´æ–¯': 'ðŸ‡°ðŸ‡®', 'ç§‘å¨ç‰¹': 'ðŸ‡°ðŸ‡¼', 'å‰å°”å‰æ–¯æ–¯å¦': 'ðŸ‡°ðŸ‡¬',
    'è€æŒ': 'ðŸ‡±ðŸ‡¦', 'æ‹‰è„±ç»´äºš': 'ðŸ‡±ðŸ‡»', 'é»Žå·´å«©': 'ðŸ‡±ðŸ‡§', 'èŽ±ç´¢æ‰˜': 'ðŸ‡±ðŸ‡¸', 'åˆ©æ¯”é‡Œäºš': 'ðŸ‡±ðŸ‡·',
    'åˆ©æ¯”äºš': 'ðŸ‡±ðŸ‡¾', 'åˆ—æ”¯æ•¦å£«ç™»': 'ðŸ‡±ðŸ‡®', 'ç«‹é™¶å®›': 'ðŸ‡±ðŸ‡¹', 'å¢æ£®å ¡': 'ðŸ‡±ðŸ‡º', 'é©¬è¾¾åŠ æ–¯åŠ ': 'ðŸ‡²ðŸ‡¬',
    'é©¬æ‹‰ç»´': 'ðŸ‡²ðŸ‡¼', 'é©¬æ¥è¥¿äºš': 'ðŸ‡²ðŸ‡¾', 'é©¬å°”ä»£å¤«': 'ðŸ‡²ðŸ‡»', 'é©¬é‡Œ': 'ðŸ‡²ðŸ‡±', 'é©¬è€³ä»–': 'ðŸ‡²ðŸ‡¹',
    'é©¬ç»å°”ç¾¤å²›': 'ðŸ‡²ðŸ‡­', 'æ¯›é‡Œå¡”å°¼äºš': 'ðŸ‡²ðŸ‡·', 'æ¯›é‡Œæ±‚æ–¯': 'ðŸ‡²ðŸ‡º', 'å¢¨è¥¿å“¥': 'ðŸ‡²ðŸ‡½', 'å¯†å…‹ç½—å°¼è¥¿äºš': 'ðŸ‡«ðŸ‡²',
    'æ‘©å°”å¤šç“¦': 'ðŸ‡²ðŸ‡©', 'æ‘©çº³å“¥': 'ðŸ‡²ðŸ‡¨', 'è’™å¤': 'ðŸ‡²ðŸ‡³', 'é»‘å±±': 'ðŸ‡²ðŸ‡ª', 'æ‘©æ´›å“¥': 'ðŸ‡²ðŸ‡¦',
    'èŽ«æ¡‘æ¯”å…‹': 'ðŸ‡²ðŸ‡¿', 'ç¼…ç”¸': 'ðŸ‡²ðŸ‡²', 'çº³ç±³æ¯”äºš': 'ðŸ‡³ðŸ‡¦', 'ç‘™é²': 'ðŸ‡³ðŸ‡·', 'å°¼æ³Šå°”': 'ðŸ‡³ðŸ‡µ',
    'è·å…°': 'ðŸ‡³ðŸ‡±', 'æ–°è¥¿å…°': 'ðŸ‡³ðŸ‡¿', 'å°¼åŠ æ‹‰ç“œ': 'ðŸ‡³ðŸ‡®', 'å°¼æ—¥å°”': 'ðŸ‡³ðŸ‡ª', 'å°¼æ—¥åˆ©äºš': 'ðŸ‡³ðŸ‡¬',
    'åŒ—é©¬å…¶é¡¿': 'ðŸ‡²ðŸ‡°', 'æŒªå¨': 'ðŸ‡³ðŸ‡´', 'é˜¿æ›¼': 'ðŸ‡´ðŸ‡²', 'å·´åŸºæ–¯å¦': 'ðŸ‡µðŸ‡°', 'å¸•åŠ³': 'ðŸ‡µðŸ‡¼',
    'å·´æ‹¿é©¬': 'ðŸ‡µðŸ‡¦', 'å·´å¸ƒäºšæ–°å‡ å†…äºš': 'ðŸ‡µðŸ‡¬', 'å·´æ‹‰åœ­': 'ðŸ‡µðŸ‡¾', 'ç§˜é²': 'ðŸ‡µðŸ‡ª', 'è²å¾‹å®¾': 'ðŸ‡µðŸ‡­',
    'æ³¢å…°': 'ðŸ‡µðŸ‡±', 'è‘¡è„ç‰™': 'ðŸ‡µðŸ‡¹', 'å¡å¡”å°”': 'ðŸ‡¶ðŸ‡¦', 'ç½—é©¬å°¼äºš': 'ðŸ‡·ðŸ‡´', 'ä¿„ç½—æ–¯è”é‚¦': 'ðŸ‡·ðŸ‡º',
    'å¢æ—ºè¾¾': 'ðŸ‡·ðŸ‡¼', 'åœ£åŸºèŒ¨å’Œå°¼ç»´æ–¯': 'ðŸ‡°ðŸ‡³', 'åœ£å¢è¥¿äºš': 'ðŸ‡±ðŸ‡¨', 'åœ£æ–‡æ£®ç‰¹å’Œæ ¼æž—çº³ä¸æ–¯': 'ðŸ‡»ðŸ‡¨', 'è¨æ‘©äºš': 'ðŸ‡¼ðŸ‡¸',
    'åœ£é©¬åŠ›è¯º': 'ðŸ‡¸ðŸ‡²', 'åœ£å¤šç¾Žå’Œæ™®æž—è¥¿æ¯”': 'ðŸ‡¸ðŸ‡¹', 'æ²™ç‰¹é˜¿æ‹‰ä¼¯': 'ðŸ‡¸ðŸ‡¦', 'å¡žå†…åŠ å°”': 'ðŸ‡¸ðŸ‡³', 'å¡žå°”ç»´äºš': 'ðŸ‡·ðŸ‡¸',
    'å¡žèˆŒå°”': 'ðŸ‡¸ðŸ‡¨', 'å¡žæ‹‰åˆ©æ˜‚': 'ðŸ‡¸ðŸ‡±', 'æ–°åŠ å¡': 'ðŸ‡¸ðŸ‡¬', 'æ–¯æ´›ä¼å…‹': 'ðŸ‡¸ðŸ‡°', 'æ–¯æ´›æ–‡å°¼äºš': 'ðŸ‡¸ðŸ‡®',
    'æ‰€ç½—é—¨ç¾¤å²›': 'ðŸ‡¸ðŸ‡§', 'ç´¢é©¬é‡Œ': 'ðŸ‡¸ðŸ‡´', 'å—éž': 'ðŸ‡¿ðŸ‡¦', 'éŸ©å›½': 'ðŸ‡°ðŸ‡·', 'å—è‹ä¸¹': 'ðŸ‡¸ðŸ‡¸',
    'è¥¿ç­ç‰™': 'ðŸ‡ªðŸ‡¸', 'æ–¯é‡Œå…°å¡': 'ðŸ‡±ðŸ‡°', 'è‹ä¸¹': 'ðŸ‡¸ðŸ‡©', 'è‹é‡Œå—': 'ðŸ‡¸ðŸ‡·', 'ç‘žå…¸': 'ðŸ‡¸ðŸ‡ª',
    'ç‘žå£«': 'ðŸ‡¨ðŸ‡­', 'å™åˆ©äºš': 'ðŸ‡¸ðŸ‡¾', 'å¡”å‰å…‹æ–¯å¦': 'ðŸ‡¹ðŸ‡¯', 'å¦æ¡‘å°¼äºš': 'ðŸ‡¹ðŸ‡¿', 'æ³°å›½': 'ðŸ‡¹ðŸ‡­',
    'ä¸œå¸æ±¶': 'ðŸ‡¹ðŸ‡±', 'å¤šå“¥': 'ðŸ‡¹ðŸ‡¬', 'æ±¤åŠ ': 'ðŸ‡¹ðŸ‡´', 'ç‰¹ç«‹å°¼è¾¾å’Œå¤šå·´å“¥': 'ðŸ‡¹ðŸ‡¹', 'çªå°¼æ–¯': 'ðŸ‡¹ðŸ‡³',
    'åœŸè€³å…¶': 'ðŸ‡¹ðŸ‡·', 'åœŸåº“æ›¼æ–¯å¦': 'ðŸ‡¹ðŸ‡²', 'å›¾ç“¦å¢': 'ðŸ‡¹ðŸ‡»', 'ä¹Œå¹²è¾¾': 'ðŸ‡ºðŸ‡¬', 'ä¹Œå…‹å…°': 'ðŸ‡ºðŸ‡¦',
    'é˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½': 'ðŸ‡¦ðŸ‡ª', 'è‹±å›½': 'ðŸ‡¬ðŸ‡§', 'ç¾Žå›½': 'ðŸ‡ºðŸ‡¸', 'ä¹Œæ‹‰åœ­': 'ðŸ‡ºðŸ‡¾', 'ä¹Œå…¹åˆ«å…‹æ–¯å¦': 'ðŸ‡ºðŸ‡¿',
    'ç“¦åŠªé˜¿å›¾': 'ðŸ‡»ðŸ‡º', 'å§”å†…ç‘žæ‹‰': 'ðŸ‡»ðŸ‡ª', 'è¶Šå—': 'ðŸ‡»ðŸ‡³', 'ä¹Ÿé—¨': 'ðŸ‡¾ðŸ‡ª', 'èµžæ¯”äºš': 'ðŸ‡¿ðŸ‡²',
    'æ´¥å·´å¸ƒéŸ¦': 'ðŸ‡¿ðŸ‡¼'
};

function updateCardLayout() {
    const cardsContainer = document.querySelector('.cards-container');
    if (!cardsContainer) return;
    
    const width = window.innerWidth;
    let columns;
    
    if (width >= 2300) {
        columns = 5;
    } else if (width >= 1800) {
        columns = 4;
    } else if (width >= 1400) {
        columns = 3;
    } else if (width >= 992) {
        columns = 2;
    } else if (width >= 768) {
        columns = 2;
    } else {
        columns = 1;
    }
    
    cardsContainer.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
}

function addFlagIfMissing(titleText) {
    if (/[\u{1F1E6}-\u{1F1FF}]{2}/u.test(titleText)) {
        return titleText;
    }
    for (const name in countryMap) {
        if (titleText.includes(name)) {
            return countryMap[name] + ' ' + titleText;
        }
    }
    return titleText;
}

function wrapEmojiWithSpan(text) {
    return text.replace(/([\u{1F1E6}-\u{1F1FF}]{2})/gu, '<span class="flag">$1</span>');
}

function extractProtocolFromTitle(titleText) {
    const match = titleText.match(/^([^\sï¼š]+)\s*([^\sï¼š]+)ï¼š\s*([\s\S]*)$/);
    if (match) {
        return {
            protocol: match[2],
            actualTitle: match[3] || ''
        };
    }
    return {
        protocol: '',
        actualTitle: titleText
    };
}

function getNodeTypeFromTitle(titleText) {
    if (titleText.includes('Sing-Box')) return 'Sing-Box';
    if (titleText.includes('Xray')) return 'Xray';
    return '';
}

function getProtocolBadge(protocol) {
    const badgeColors = {
        'HY2': '#ff6b6b',
        'HY': '#ffa726',
        'VMess': '#42a5f5',
        'VLESS': '#5c6bc0',
        'SS': '#66bb6a',
        'SSR': '#4caf50',
        'WG': '#ab47bc',
        'Trojan': '#ff69b4',
        'URLTest': '#7e57c2',
        'Balancing': '#ef5350',
        'Shunt': '#26a69a'
    };
    const badgeTexts = {
        'HY2': 'HY2',
        'HY': 'HY',
        'VMess': 'VMess',
        'VLESS': 'VLESS',
        'SS': 'SS',
        'SSR': 'SSR',
        'WG': 'WG',
        'Trojan': 'Trojan',
        'URLTest': 'Test',
        'Balancing': 'Balance',
        'Shunt': 'Shunt'
    };
    const color = badgeColors[protocol] || '#000';
    const text = badgeTexts[protocol] || protocol;
    return `<span class="card-badge" style="background-color: ${color}">${text}</span>`;
}

function convertTablesToCards() {
    const activeContainer = document.querySelector('.cbi-tabcontainer[style*="display: block"], .cbi-tabcontainer[style*="display:block"]');
    if (!activeContainer) return;
    if (activeContainer.getAttribute('data-cards-converted') === 'true') return;

    const table = activeContainer.querySelector('.cbi-section-table');
    if (!table) return;

    const rows = table.querySelectorAll('.cbi-section-table-row');
    if (!rows.length) return;

    const cardsContainer = document.createElement('div');
    cardsContainer.className = 'cards-container';
    
    const group = table.id.replace('cbi-passwall-nodes-', '').replace('-table', '');
    cardsContainer.setAttribute('data-group', group);

    rows.forEach(row => {
        const card = document.createElement('div');
        card.className = 'node-card';
        card.setAttribute('data-id', row.id.replace('cbi-passwall-', ''));
        if (row.classList.contains('_now_use_bg')) card.classList.add('_now_use_bg');

        const tds = row.querySelectorAll('td');
        const originalTitle = tds[0]?.textContent || '';
        const ping = tds[1]?.innerHTML || '';
        const tcping = tds[2]?.innerHTML || '';
        const urlTest = tds[3]?.innerHTML || '';
        const actions = tds[4]?.innerHTML || '';

        const remarksSpan = tds[0]?.querySelector('span, div, a');
        let remarksClass = '';
        if (remarksSpan && remarksSpan.classList.contains('_now_use')) remarksClass = '_now_use';

        const { protocol, actualTitle } = extractProtocolFromTitle(originalTitle);
        const nodeType = getNodeTypeFromTitle(originalTitle);

        const titleWithFlag = addFlagIfMissing(actualTitle);

        let badgeHtml = protocol ? getProtocolBadge(protocol) : '';
        if (nodeType && badgeHtml) {
            badgeHtml = badgeHtml.replace('<span class="card-badge"', `<span class="card-badge" title="${nodeType}"`);
        }

        card.innerHTML = `
            <div class="card-header ${remarksClass}">
                ${wrapEmojiWithSpan(titleWithFlag)}
                ${badgeHtml}
            </div>
            <div class="card-metrics">
                <div class="metric-item">Ping: ${ping}</div>
                <div class="metric-item">TCPing: ${tcping}</div>
                <div class="metric-item">URL: ${urlTest}</div>
            </div>
            <div class="card-actions">${actions}</div>
        `;

        //if (nodeType) card.title = `${nodeType}`;

        cardsContainer.appendChild(card);
    });

    table.parentNode.insertBefore(cardsContainer, table);
    activeContainer.setAttribute('data-cards-converted', 'true');
    
    updateCardLayout();
    
    initCardSortable(cardsContainer, group);
    rebindURLEvents(cardsContainer);
}

window.addEventListener('resize', updateCardLayout);

function initCardSortable(container, group) {
    if (typeof Sortable === 'undefined') return;
    
    const isSmallScreen = window.innerWidth < 768;
    
    if (isSmallScreen) {
        const dragHandles = container.querySelectorAll('.drag-handle');
        dragHandles.forEach(handle => {
            handle.style.display = 'none';
        });
        return;
    }
    
    try {
        Sortable.create(container, {
            handle: ".node-card, .drag-handle",
            animation: 150,
            ghostClass: "sortable-ghost",
            chosenClass: "sortable-chosen",
            dragClass: "dragging-row",
            onEnd: function(evt) {
                saveCardOrder(group);
            }
        });
    } catch (err) {
        console.error('Sortable init failed for cards:', err);
    }
}

function saveCardOrder(group) {
    const container = document.querySelector(`.cards-container[data-group="${group}"]`);
    if (!container) return;
    
    const cards = container.querySelectorAll('.node-card');
    if (!cards.length) return;
    
    const btn = document.getElementById("save_order_btn_" + group);
    if (btn) btn.disabled = true;
    
    const ids = [];
    cards.forEach(card => {
        const id = card.getAttribute('data-id');
        if (id) ids.push(id);
    });
    
    XHR.get('<%=api.url("save_node_order")%>', {
        group: group,
        ids: ids.join(",")
    },
    function(x, result) {
        if (btn) btn.disabled = false;
        if (x && x.status === 200) {
            const successMsg = "<%:Saved current page order successfully.%>";
            if (typeof showLogMessage === 'function') {
                showLogMessage(successMsg);
            }
            if (typeof colorVoiceEnabled !== 'undefined' && colorVoiceEnabled) {
                speakMessage(successMsg);
            }
        } else {
            const errorMsg = "<%:Save failed!%>";
            if (typeof showLogMessage === 'function') {
                showLogMessage(errorMsg);
            }
            if (typeof colorVoiceEnabled !== 'undefined' && colorVoiceEnabled) {
                speakMessage(errorMsg);
            }
        }
    });
}

function rebindURLEvents(container) {
    container.querySelectorAll('.metric-item:nth-child(3) a').forEach(link => {
        const originalOnClick = link.getAttribute('onclick');
        if (originalOnClick && originalOnClick.includes('urltest_node')) {
            link.removeAttribute('onclick');
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const match = originalOnClick.match(/urltest_node\('([^']+)', this\)/);
                if (match) {
                    const cbiId = match[1];
                    urltest_node(cbiId, this);
                }
            });
        }
    });
}

function initAllTabs() {
    document.querySelectorAll('.cbi-tabcontainer').forEach(container => {
        container.removeAttribute('data-cards-converted');
        const oldCards = container.querySelector('.cards-container');
        if (oldCards) oldCards.remove();
    });
    convertTablesToCards();
}

document.addEventListener('DOMContentLoaded', () => setTimeout(initAllTabs, 100));
document.addEventListener('click', e => {
    const tabLink = e.target.closest('.cbi-tab');
    if (tabLink && tabLink.querySelector('a')) setTimeout(initAllTabs, 200);
});

const observer = new MutationObserver(mutations => {
    mutations.forEach(mutation => {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
            const target = mutation.target;
            if (target.classList.contains('cbi-tabcontainer') && target.style.display.includes('block')) {
                setTimeout(initAllTabs, 100);
            }
        }
    });
});

observer.observe(document.body, {
    attributes: true,
    subtree: true,
    attributeFilter: ['style']
});
</script>
</body>
</html>
